<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Spark Shuffle è§£æå®½ä¾èµ–å’Œçª„ä¾èµ– çª„ä¾èµ– æ²¡æœ‰æ•°æ®shuffling æ‰€æœ‰çˆ¶RDDä¸­çš„Partitionå‡ä¼šå’Œå­RDDçš„Partitionå…³ç³»æ˜¯ä¸€å¯¹ä¸€      å®½ä¾èµ– æœ‰æ•°æ®shuffling æ‰€æœ‰çˆ¶RDDä¸­çš„Partitionä¼šè¢«åˆ‡åˆ†ï¼Œæ ¹æ®keyçš„ä¸åŒåˆ’åˆ†åˆ°å­RDDçš„Partitionä¸­     å›é¡¾ Stageä»€ä¹ˆæ˜¯Stage  ä¸€ä¸ªJobä¼šè¢«æ‹†åˆ†ä¸ºå¤šç»„Taskï¼Œæ¯ç»„Taskè¢«">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2023/09/10/13-%E5%A4%A7%E6%95%B0%E6%8D%AE/03-Spark/03-SparkShuffle&SQL&MLlib/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Spark Shuffle è§£æå®½ä¾èµ–å’Œçª„ä¾èµ– çª„ä¾èµ– æ²¡æœ‰æ•°æ®shuffling æ‰€æœ‰çˆ¶RDDä¸­çš„Partitionå‡ä¼šå’Œå­RDDçš„Partitionå…³ç³»æ˜¯ä¸€å¯¹ä¸€      å®½ä¾èµ– æœ‰æ•°æ®shuffling æ‰€æœ‰çˆ¶RDDä¸­çš„Partitionä¼šè¢«åˆ‡åˆ†ï¼Œæ ¹æ®keyçš„ä¸åŒåˆ’åˆ†åˆ°å­RDDçš„Partitionä¸­     å›é¡¾ Stageä»€ä¹ˆæ˜¯Stage  ä¸€ä¸ªJobä¼šè¢«æ‹†åˆ†ä¸ºå¤šç»„Taskï¼Œæ¯ç»„Taskè¢«">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220220221711.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220220221827.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220220222050.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306195805.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306195849.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200055.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200203.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200304.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200419.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200503.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200734.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200953.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306201108.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306201150.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306201729.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306201938.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306202002.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306202048.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306202628.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306202933.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306203028.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306203120.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220404112704.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306204539.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306204833.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205421.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205450.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205524.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205628.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205524.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205728.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205809.png">
<meta property="article:published_time" content="2023-09-10T03:59:07.646Z">
<meta property="article:modified_time" content="2022-09-03T09:25:37.839Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220220221711.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-13-å¤§æ•°æ®/03-Spark/03-SparkShuffle&amp;SQL&amp;MLlib" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/09/10/13-%E5%A4%A7%E6%95%B0%E6%8D%AE/03-Spark/03-SparkShuffle&SQL&MLlib/" class="article-date">
  <time class="dt-published" datetime="2023-09-10T03:59:07.646Z" itemprop="datePublished">2023-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Spark-Shuffle-è§£æ"><a href="#Spark-Shuffle-è§£æ" class="headerlink" title="Spark Shuffle è§£æ"></a>Spark Shuffle è§£æ</h1><h2 id="å®½ä¾èµ–å’Œçª„ä¾èµ–"><a href="#å®½ä¾èµ–å’Œçª„ä¾èµ–" class="headerlink" title="å®½ä¾èµ–å’Œçª„ä¾èµ–"></a>å®½ä¾èµ–å’Œçª„ä¾èµ–</h2><ul>
<li>çª„ä¾èµ–<ul>
<li>æ²¡æœ‰æ•°æ®shuffling</li>
<li>æ‰€æœ‰çˆ¶RDDä¸­çš„Partitionå‡ä¼šå’Œå­RDDçš„Partitionå…³ç³»æ˜¯ä¸€å¯¹ä¸€</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220220221711.png"></p>
<ul>
<li>å®½ä¾èµ–<ul>
<li>æœ‰æ•°æ®shuffling</li>
<li>æ‰€æœ‰çˆ¶RDDä¸­çš„Partitionä¼šè¢«åˆ‡åˆ†ï¼Œæ ¹æ®keyçš„ä¸åŒåˆ’åˆ†åˆ°å­RDDçš„Partitionä¸­</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220220221827.png"></p>
<h2 id="å›é¡¾-Stage"><a href="#å›é¡¾-Stage" class="headerlink" title="å›é¡¾ Stage"></a>å›é¡¾ Stage</h2><p>ä»€ä¹ˆæ˜¯Stage</p>
<ul>
<li>ä¸€ä¸ªJobä¼šè¢«æ‹†åˆ†ä¸ºå¤šç»„Taskï¼Œæ¯ç»„Taskè¢«ç§°ä¸ºä¸€ä¸ªStage</li>
</ul>
<p>åˆ’åˆ†ä¾æ®</p>
<ul>
<li>ä»¥shuffleæ“ä½œä½œä¸ºè¾¹ç•Œï¼Œé‡åˆ°ä¸€ä¸ªå®½ä¾èµ–å°±åˆ†ä¸€ä¸ªstage</li>
</ul>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220220222050.png"></p>
<h2 id="å¼•èµ·shuffleçš„ç®—å­"><a href="#å¼•èµ·shuffleçš„ç®—å­" class="headerlink" title="å¼•èµ·shuffleçš„ç®—å­"></a>å¼•èµ·shuffleçš„ç®—å­</h2><ul>
<li>repartition</li>
<li>groupByKey</li>
<li>combineByKey</li>
<li>reduceByKey</li>
<li>aggregateByKey</li>
</ul>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306195805.png"></p>
<ul>
<li>intersection</li>
<li>join</li>
<li>cogroup</li>
</ul>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306195849.png"></p>
<h2 id="MapReduce-Shuffle-å›é¡¾"><a href="#MapReduce-Shuffle-å›é¡¾" class="headerlink" title="MapReduce Shuffle å›é¡¾"></a>MapReduce Shuffle å›é¡¾</h2><p>map æ•°æ®æ˜ å°„ï¼Œreduce æ•°æ®èšåˆ</p>
<ul>
<li>Mapç«¯å®Œæˆä¹‹åä¼šæš´éœ²ä¸€ä¸ªHttp Serverå…±Reduceç«¯è·å–æ•°æ®</li>
<li>Reduceå¯åŠ¨æ‹·è´çº¿ç¨‹ä»å„ä¸ªMapç«¯æ‹·è´ç»“æœ<ul>
<li>æœ‰å¤§é‡çš„ç½‘ç»œI&#x2F;Oå¼€é”€</li>
</ul>
</li>
<li>ä¸€è¾¹æ‹·è´ä¸€è¾¹è¿›è¡ŒMergeæ“ä½œï¼ˆå½’å¹¶æ’åºï¼‰</li>
</ul>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200055.png"></p>
<h2 id="Spark-Shuffle-ä¸¤é˜¶æ®µ"><a href="#Spark-Shuffle-ä¸¤é˜¶æ®µ" class="headerlink" title="Spark Shuffle ä¸¤é˜¶æ®µ"></a>Spark Shuffle ä¸¤é˜¶æ®µ</h2><p>ä¸ºä»€ä¹ˆ spark ä¸æŠŠ shuffle ç»“æœç›´æ¥å†™åˆ°å†…å­˜è€Œæ˜¯å†™åˆ°ç£ç›˜ï¼Ÿ</p>
<ol>
<li>ä¸€èˆ¬å¤§æ•°æ®åœºæ™¯æ•°æ®éƒ½æ˜¯TBã€PBçº§åˆ«ï¼Œå…¨éƒ¨å†™åˆ°å†…å­˜å¯èƒ½ä¼šå†…å­˜æº¢å‡ºï¼Œå†…å­˜æ”¾ä¸ä¸‹</li>
<li>å³ä¾¿å†…å­˜æ”¾ä¸‹ï¼Œç”±äºç¨‹åºã€ç½‘è·¯ç­‰åŸå› å¯¼è‡´èŠ‚ç‚¹å®•æœºï¼Œæ•´ä¸ª shuffle è¦é‡æ–°è®¡ç®—ï¼Œæˆæœ¬è¾ƒé«˜</li>
</ol>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200203.png"></p>
<h2 id="Shuffle-æ˜¯ä¸ªæ˜‚è´µçš„æ“ä½œ"><a href="#Shuffle-æ˜¯ä¸ªæ˜‚è´µçš„æ“ä½œ" class="headerlink" title="Shuffle æ˜¯ä¸ªæ˜‚è´µçš„æ“ä½œ"></a>Shuffle æ˜¯ä¸ªæ˜‚è´µçš„æ“ä½œ</h2><ul>
<li><p>æ•°æ®åˆ†åŒº</p>
<p>ä¸€ä¸ªRDDåˆ°å¦ä¸€ä¸ªRDDè½¬æ¢å°±éœ€è¦è¿›è¡Œæ•°æ®åˆ†åŒºï¼ŒåŸºæœ¬ä¸Š90%çš„åˆ†åŒºéƒ½æ˜¯HashPartitionï¼Œå‰©ä¸‹ä¸ºRangePartitionï¼ŒsortByKeyåº•å±‚å°±æ˜¯RangePartition</p>
</li>
<li><p>åºåˆ—åŒ–ååºåˆ—åŒ–</p>
<p>æ•°æ®è½åˆ°ç£ç›˜ä¸Šå°±ä¼šæ¶‰åŠåˆ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œåºåˆ—åŒ–ååºåˆ—åŒ–ä¼šéå¸¸æ¶ˆè€—cpuï¼Œä¼˜åŒ–å¯ä»¥ä»åºåˆ—åŒ–ååºåˆ—åŒ–å»è€ƒè™‘</p>
</li>
<li><p>æ•°æ®å‹ç¼©</p>
<p>åˆ†å¸ƒå¼è®¡ç®—æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´äº¤äº’éœ€è¦é€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œç½‘ç»œå¸¦å®½èµ„æºæ˜¯æœ‰é™çš„ï¼Œéœ€è¦å¯¹æ•°æ®è¿›è¡Œä¸€å®šç¨‹åº¦å‹ç¼©ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½éœ€è¦å‹ç¼©ï¼Œå› ä¸ºå‹ç¼©æ•°æ®ä¹Ÿæ˜¯éœ€è¦è€—è´¹cpuçš„ï¼Œå½“ä¼ è¾“æˆæœ¬å¤§äºcpuæˆæœ¬å¯ä»¥è€ƒè™‘å¼€å¯å‹ç¼©</p>
</li>
<li><p>ç£ç›˜IO</p>
<p>å¤§æ•°æ®åœºæ™¯å†™å…¥æ•°æ®æ˜¯æœ‰åºçš„å¯ä»¥å‡å°‘ç£ç›˜å¯»é“çš„æ—¶é—´ï¼Œè¿™æ ·ååé‡ä¹Ÿé«˜</p>
</li>
</ul>
<h2 id="Shuffle-å®ç°è¿›åŒ–å†å²"><a href="#Shuffle-å®ç°è¿›åŒ–å†å²" class="headerlink" title="Shuffle å®ç°è¿›åŒ–å†å²"></a>Shuffle å®ç°è¿›åŒ–å†å²</h2><p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200304.png"></p>
<h2 id="Shuffle-ç›¸å…³ç»„ä»¶"><a href="#Shuffle-ç›¸å…³ç»„ä»¶" class="headerlink" title="Shuffle ç›¸å…³ç»„ä»¶"></a>Shuffle ç›¸å…³ç»„ä»¶</h2><p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200419.png"></p>
<h2 id="Hash-Shuffle"><a href="#Hash-Shuffle" class="headerlink" title="Hash Shuffle"></a>Hash Shuffle</h2><p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200503.png"></p>
<h2 id="Hash-Shuffle-å­˜åœ¨çš„é—®é¢˜ï¼Ÿ"><a href="#Hash-Shuffle-å­˜åœ¨çš„é—®é¢˜ï¼Ÿ" class="headerlink" title="Hash Shuffle å­˜åœ¨çš„é—®é¢˜ï¼Ÿ"></a>Hash Shuffle å­˜åœ¨çš„é—®é¢˜ï¼Ÿ</h2><p><strong>æ‰“å¼€æ–‡ä»¶è¿‡å¤š</strong></p>
<ul>
<li>å‡è®¾N(Shuffle Map Task) &#x3D; 1000ï¼ŒN(Following Task) &#x3D; 500ï¼Œåˆ™ä¼šç”Ÿæˆ50ä¸‡ä¸ªå°æ–‡ä»¶ã€‚</li>
<li>æ¯æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶éœ€è¦å ç”¨ä¸€å®šé‡å†…å­˜ç©ºé—´ï¼Œå‡è®¾ä¸€ä¸ªå¥æŸ„å æ®100Kï¼Œåˆ™50ä¸‡ä¸ªå°æ–‡ä»¶éœ€è¦å æ®50GBã€‚</li>
</ul>
<p><strong>å¤§é‡éšæœºIO</strong></p>
<ul>
<li>Shuffle Map Taskéšæœºå†™ã€‚</li>
<li>Following Taskéšæœºè¯»ã€‚</li>
<li>æœºæ¢°ç£ç›˜çš„éšæœºæ€§èƒ½è¿œä¸å¦‚é¡ºåºå†™å…¥æ€§èƒ½ã€‚</li>
</ul>
<p><strong>é¢‘ç¹GC</strong></p>
<ul>
<li>æ‰“å¼€å…³é—­æ–‡ä»¶</li>
<li>å¤§é‡çš„åºåˆ—åŒ–ååºåˆ—åŒ–æ“ä½œ</li>
</ul>
<h2 id="Sort-Shuffle"><a href="#Sort-Shuffle" class="headerlink" title="Sort Shuffle"></a>Sort Shuffle</h2><p>å…ˆåœ¨å†…å­˜ä¸­è¿›è¡Œåˆ†åŒºï¼Œå¿«å†™æ»¡æ—¶è¿›è¡Œä¸€ä¸ªæ’åºå†™å…¥åˆ°ç£ç›˜ï¼Œå½“è¿™ä¸ªè¡Œä¸ºå‘é€næ¬¡ï¼Œè¯´æ˜åœ¨ç£ç›˜ç”Ÿæˆnä¸ªæ–‡ä»¶ã€‚æŠŠnä¸ªæ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¤§çš„æ–‡ä»¶ï¼Œmerge sortå¯ä»¥å¿«é€Ÿè¿›è¡Œæ’åºï¼Œå› ä¸ºç£ç›˜ä¸Šçš„æ–‡ä»¶å·²ç»æ˜¯æœ‰åºçš„ï¼Œè¿˜ä¼šç”Ÿæˆä¸€ä¸ªindexï¼Œä¸‹æ¸¸åœ¨è¯»å–çš„æ—¶å€™ä¼šä»è¿™é‡Œè¯»å–æ•°æ®åç§»é‡å†ä»æ–‡ä»¶ä¸­åç§»é‡ä½ç½®è¯»å–æ•°æ®ã€‚</p>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200734.png"></p>
<h2 id="Sort-Shuffle-å­˜åœ¨çš„é—®é¢˜ï¼Ÿ"><a href="#Sort-Shuffle-å­˜åœ¨çš„é—®é¢˜ï¼Ÿ" class="headerlink" title="Sort Shuffle å­˜åœ¨çš„é—®é¢˜ï¼Ÿ"></a>Sort Shuffle å­˜åœ¨çš„é—®é¢˜ï¼Ÿ</h2><p><strong>éœ€è¦è¿›è¡Œæ’åº</strong></p>
<ul>
<li>Spillå†™å…¥æ–‡ä»¶çš„æ—¶å€™éœ€è¦æŒ‰ç…§partitionIdå¯¹Keyè¿›è¡Œæ’åº</li>
<li>åœ¨mergeé˜¶æ®µéœ€è¦å¯¹è¿›è¡Œå½’å¹¶æ’åºåˆå¹¶æˆä¸€ä¸ªå¤§æ–‡ä»¶</li>
</ul>
<p><strong>å¤§é‡åºåˆ—åŒ–ååºåˆ—åŒ–</strong></p>
<ul>
<li>Spillå†™å…¥æ–‡ä»¶æ—¶</li>
<li>åˆå¹¶æ–‡ä»¶è¿›è¡Œå½’å¹¶æ’åºæ—¶</li>
</ul>
<h2 id="Sort-Shuffle-æ”¹è¿›-Tungsten-è®¡åˆ’"><a href="#Sort-Shuffle-æ”¹è¿›-Tungsten-è®¡åˆ’" class="headerlink" title="Sort Shuffle æ”¹è¿› Tungsten è®¡åˆ’"></a>Sort Shuffle æ”¹è¿› Tungsten è®¡åˆ’</h2><h3 id="æ”¹è¿›æªæ–½1ï¼šæ›´é«˜çº§çš„å†…å­˜ç®¡ç†"><a href="#æ”¹è¿›æªæ–½1ï¼šæ›´é«˜çº§çš„å†…å­˜ç®¡ç†" class="headerlink" title="æ”¹è¿›æªæ–½1ï¼šæ›´é«˜çº§çš„å†…å­˜ç®¡ç†"></a>æ”¹è¿›æªæ–½1ï¼šæ›´é«˜çº§çš„å†…å­˜ç®¡ç†</h3><ul>
<li><p>ä½¿ç”¨sun.misc.Unsafeç›´æ¥ç®¡ç†å†…å­˜ï¼Œæ¶ˆé™¤GC</p>
</li>
<li><p>ä¾‹å¦‚ä¸€ä¸ªç®€å•å­—ç¬¦ä¸²abcdï¼Œå®é™…å ç”¨24ä¸ªå­—èŠ‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java.lang.String object internals:</span><br><span class="line">OFFSET SIZE TYPE DESCRIPTION VALUE</span><br><span class="line">0 4 (object header) ...</span><br><span class="line">4 4 (object header) ...</span><br><span class="line">8 4 (object header) ...</span><br><span class="line">12 4 char[] String.value []</span><br><span class="line">16 4 int String.hash 0</span><br><span class="line">20 4 int String.hash32 0</span><br><span class="line">Instance size: 24 bytes (reported by Instrumentation API)</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306200953.png"></p>
<h3 id="æ”¹è¿›æªæ–½2ï¼šç¼“å­˜æ„ŸçŸ¥è®¡ç®—"><a href="#æ”¹è¿›æªæ–½2ï¼šç¼“å­˜æ„ŸçŸ¥è®¡ç®—" class="headerlink" title="æ”¹è¿›æªæ–½2ï¼šç¼“å­˜æ„ŸçŸ¥è®¡ç®—"></a>æ”¹è¿›æªæ–½2ï¼šç¼“å­˜æ„ŸçŸ¥è®¡ç®—</h3><p>æ ¸å¿ƒï¼šå°½å¯èƒ½æŠŠæ•°æ®æ”¾åˆ°é è¿‘cpuçš„ç¼“å­˜ä¸­</p>
<p>ä¸‹å›¾æœ‰ä¸€ä¸ªptrçš„æ•°ç»„ï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯æŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘key valueå­˜å‚¨çš„åœ°æ–¹ï¼Œæˆ‘ä»¬æ’åºçš„æ—¶å€™ç§»åŠ¨çš„æ˜¯æ¯ä¸€ä¸ªæŒ‡é’ˆçš„ä½ç½®ï¼Œptr2å¤§äºptr3ï¼Œæˆ‘ä»¬äº¤äº’çš„æ˜¯è¿™ä¿©ä¸ªæŒ‡é’ˆçš„ï¼Œcpuåœ¨åšè®¡ç®—çš„æ—¶å€™æ˜¯å…ˆè®¿é—®æ•°ç»„ï¼Œå†è®¿é—®å¯¹åº”key valueï¼Œå¾€å¾€æˆ‘ä»¬å¯ä»¥æŠŠæ•°ç»„æ”¾åˆ°L1ã€L2ã€L3ä¸­ï¼Œä½†æ˜¯key valueä¿¡æ¯æ¯”è¾ƒå¤§ï¼Œå¾€å¾€æ˜¯åœ¨Memoryä¸­ï¼Œæ‰€ä»¥cpuä¼šåœ¨L1ã€L2ã€L3å’ŒMemoryä¸­æ¥å›å¥”æ³¢ã€‚æˆ‘ä»¬å¯ä»¥æŠŠkeyå’ŒæŒ‡é’ˆå­˜æ”¾åˆ°ä¸€èµ·ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„æ˜¯valueï¼Œäº¤æ¢çš„æ—¶å€™ç›´æ¥åœ¨æ•°ç»„ä¸­è¿›è¡Œäº¤æ¢ï¼Œå› ä¸ºkeyç±»å‹éƒ½æ˜¯å›ºå®šçš„ï¼Œä¾‹å¦‚longã€intï¼Œé‡å¯æ§ï¼ŒæŠŠkeyå’ŒæŒ‡é’ˆæ”¾åˆ°ä¸€èµ·å°±æ›´æœ‰å¯èƒ½æŠŠæ•´ä¸ªæ’åºæ•°ç»„æ”¾åˆ°cpuçš„ç¼“å­˜ä¸­å»ã€‚tungsten å®ç°åæœ‰3å€çš„æ€§èƒ½æå‡</p>
<ul>
<li>æé«˜ç¼“å­˜å‘½ä¸­ç‡</li>
<li>é€Ÿåº¦ L1&gt;L2&gt;L3&gt;å†…å­˜&gt;ç£ç›˜</li>
</ul>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306201108.png"></p>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306201150.png"></p>
<h2 id="But-ä½¿ç”¨Tungstené™åˆ¶æ¡ä»¶"><a href="#But-ä½¿ç”¨Tungstené™åˆ¶æ¡ä»¶" class="headerlink" title="But ä½¿ç”¨Tungstené™åˆ¶æ¡ä»¶"></a>But ä½¿ç”¨Tungstené™åˆ¶æ¡ä»¶</h2><ol>
<li>åœ¨shuffleé˜¶æ®µä¸èƒ½æœ‰aggregateï¼šä¾‹å¦‚reduceByKey</li>
<li>åˆ†åŒºæ•°ä¸èƒ½è¶…è¿‡2<sup>24</sup> âˆ’ 1</li>
</ol>
<h2 id="Shuffleè°ƒä¼˜"><a href="#Shuffleè°ƒä¼˜" class="headerlink" title="Shuffleè°ƒä¼˜"></a>Shuffleè°ƒä¼˜</h2><ol>
<li><p>è°ƒæ•´spillé¢‘ç‡</p>
<ul>
<li>spark.shuffle.file.buffer<ul>
<li>map taskçš„å†…å­˜ç¼“å†²è°ƒèŠ‚å‚æ•°ï¼Œé»˜è®¤æ˜¯32kb</li>
</ul>
</li>
<li>spark.shuffle.memoryFraction<ul>
<li>reduceç«¯èšåˆå†…å­˜å æ¯”ï¼Œé»˜è®¤0.2</li>
</ul>
</li>
<li>å¦‚ä½•è°ƒæ•´ï¼Ÿ<ul>
<li>é€šè¿‡ç›‘æ§å¹³å°è§‚å¯Ÿshuffle writeå’Œshuffle readçš„è¿è¡Œæ¬¡æ•°</li>
</ul>
</li>
</ul>
</li>
<li><p>å°½é‡å‡å°‘Shuffleæ¬¡æ•°</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸¤æ¬¡shuffle</span></span><br><span class="line">rdd.map(...).repartition(<span class="number">1000</span>).reduceByKey(_ + _, <span class="number">3000</span>)</span><br><span class="line"><span class="comment">// ä¸€æ¬¡shuffle</span></span><br><span class="line">rdd.map(...).reduceByKey(_ + _, <span class="number">3000</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="Spark-SQL-åŸç†"><a href="#Spark-SQL-åŸç†" class="headerlink" title="Spark SQL åŸç†"></a>Spark SQL åŸç†</h1><h2 id="Spark-SQL"><a href="#Spark-SQL" class="headerlink" title="Spark SQL"></a>Spark SQL</h2><p>Sparkä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºå¤„ç†ç»“æ„åŒ–æ•°æ®</p>
<ul>
<li>æ— ç¼é›†æˆSQLæŸ¥è¯¢</li>
<li>ç»Ÿä¸€æ•°æ®è®¿é—®æ–¹æ³•</li>
<li>Hiveé«˜åº¦é›†æˆ</li>
<li>æ”¯æŒJDBCå’ŒODBC</li>
<li>å¤šè¯­è¨€Scala Python</li>
</ul>
<h2 id="Spark-SQL-Example"><a href="#Spark-SQL-Example" class="headerlink" title="Spark SQL Example"></a>Spark SQL Example</h2><p>åœ¨Sparkç¨‹åºä¸­æ— ç¼é›†æˆSQLæŸ¥è¯¢</p>
<ol>
<li>df.registerTempTable(â€œcourse_scoreâ€)</li>
<li>sqlContext.sql(â€œselect name, avg(score) from course_score group by nameâ€).show()</li>
</ol>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306201729.png"></p>
<h2 id="Spark-SQL-åŸç†-1"><a href="#Spark-SQL-åŸç†-1" class="headerlink" title="Spark SQL åŸç†"></a>Spark SQL åŸç†</h2><p><strong>scoreè¡¨</strong></p>
<table>
<thead>
<tr>
<th>å­—æ®µåç§°</th>
<th>å­—æ®µç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>LONG</td>
</tr>
<tr>
<td>match_score</td>
<td>INT</td>
</tr>
<tr>
<td>english_score</td>
<td>INT</td>
</tr>
</tbody></table>
<p><strong>peopleè¡¨</strong></p>
<table>
<thead>
<tr>
<th>å­—æ®µåç§°</th>
<th>å­—æ®µç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>LONG</td>
</tr>
<tr>
<td>age</td>
<td>INT</td>
</tr>
<tr>
<td>name</td>
<td>STRING</td>
</tr>
</tbody></table>
<p>æ±‚å¤§äº18å²çš„åŒå­¦æ€»æˆç»©å¹³å‡åˆ†</p>
<ol>
<li>é¦–å…ˆç”±SqlParserå°†sqlè§£æä¸ºä¸€æ£µæ ‘ï¼Œè¿™æ£µæ ‘ç§°ä¸ºæ²¡æœ‰åˆ†æçš„æ‰§è¡Œè®¡åˆ’</li>
<li>Analyzeråˆ†æå™¨åˆ†ææ²¡æœ‰åˆ†æçš„æ‰§è¡Œè®¡åˆ’å¾—åˆ°é€»è¾‘æ‰§è¡Œæ ‘ï¼ŒåŒ…å«æ‰§è¡Œçš„å…³é”®ä¿¡æ¯ï¼Œå¯ä»¥æ‹¿è¿™æ£µæ ‘è¿›è¡Œæ‰§è¡Œäº†ï¼Œä½†æ˜¯è¿˜éœ€è¦å†è¿›è¡Œä¼˜åŒ–ã€‚</li>
<li>Optimizerè¿›è¡Œsqlä¼˜åŒ–ï¼Œå¯¹äºåˆ†æåçš„è¿™æ£µæ ‘è¿›è¡Œç­‰ä»·çš„äº¤äº’ï¼Œä¿è¯æ‰§è¡Œç»“æœçš„æ­£ç¡®æ€§</li>
<li>Plannerå°†ä¼˜åŒ–åçš„é€»è¾‘æ‰§è¡Œæ ‘ç”Ÿæˆä¸€ä¸ªç‰©ç†çš„æ‰§è¡Œè®¡åˆ’</li>
<li>Prepare for Executionå°†Spark Planè½¬æ¢ä¸ºä¸€ä¸ªå¯ä»¥æ‰§è¡Œçš„è®¡åˆ’</li>
<li>æœ€ç»ˆå°†ç»™executeè½¬æ¢ä¸ºRDDè¿›è¡Œè®¡ç®—</li>
</ol>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306201938.png"></p>
<h2 id="SQL-Parser"><a href="#SQL-Parser" class="headerlink" title="SQL Parser"></a>SQL Parser</h2><p>SqlBase.g4æ–‡ä»¶ï¼š<a target="_blank" rel="noopener" href="https://github.com/apache/spark/blob/v2.4.0/sql/catalyst/src/main/antlr4/org/apache/spark/sql/catalyst/parser/SqlBase.g4">https://github.com/apache/spark/blob/v2.4.0/sql/catalyst/src/main/antlr4/org/apache/spark/sql/catalyst/parser/SqlBase.g4</a></p>
<p>ideaå®‰è£…antlræ’ä»¶ï¼Œè¾“å…¥SELECT * FROM SCOREï¼Œæ³¨æ„è¦å…¨å¤§å†™ï¼Œç„¶åç‚¹å‡»æ–‡ä»¶49è¡Œçš„singleStatementå³é”®Test Rule singleStatementå°±å¯ä»¥å¾—åˆ°æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰</p>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306202002.png"></p>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306202048.png"></p>
<h2 id="SQL-Analyzer"><a href="#SQL-Analyzer" class="headerlink" title="SQL Analyzer"></a>SQL Analyzer</h2><ol>
<li>ç»è¿‡Parserä¹‹åçš„LogicalPlanå¹¶ä¸çŸ¥é“å¦‚ä½•æ‰§è¡Œ</li>
<li>éœ€è¦ç»‘å®šä¸ç¡®å®šçš„å±æ€§å’Œå…³ç³»<ul>
<li>è§£æè¡¨å<ul>
<li>ä¸´æ—¶è¡¨</li>
<li>ä¸´æ—¶view</li>
<li>hive table</li>
<li>hive view</li>
</ul>
</li>
<li>è§£æå…·ä½“çš„schemaç»“æ„<ul>
<li>å­—æ®µç±»å‹</li>
<li>å­˜å‚¨ä½ç½®</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306202628.png"></p>
<h2 id="SQL-Optimizer"><a href="#SQL-Optimizer" class="headerlink" title="SQL Optimizer"></a>SQL Optimizer</h2><ol>
<li><p>ä¸åŒç”¨æˆ·æäº¤SQLè´¨é‡ä¸åŒ</p>
</li>
<li><p>ä¿è¯SQLéœ€è¦è¢«é«˜æ•ˆæ‰§è¡Œ</p>
</li>
<li><p>Spark SQLä¸»è¦é‡‡ç”¨è§„åˆ™ä¼˜åŒ–æ–¹æ³•</p>
<ol>
<li><p>è°“è¯ä¸‹æ¨</p>
<p>å‡å°‘å‚ä¸è®¡ç®—çš„æ•°æ®é‡</p>
</li>
<li><p>åˆ—å€¼è£å‰ª</p>
<p>å‡å°‘Filterä¸Projectæ“ä½œçš„ä¸­é—´ç»“æœé›†æ•°æ®é‡</p>
</li>
<li><p>å¸¸é‡ç´¯åŠ </p>
<p>å‡å°‘é‡å¤è®¡ç®—</p>
</li>
<li><p>Joiné‡æ’åº</p>
<p>å°½å¯èƒ½åœ°å°†å¸¦æœ‰æ¡ä»¶è¿‡æ»¤çš„å­æ‰§è¡Œè®¡åˆ’ä¸‹æ¨åˆ°æ‰§è¡Œæ ‘çš„æœ€åº•å±‚</p>
</li>
</ol>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">// Operator push down</span><br><span class="line">PushProjectionThroughUnion,</span><br><span class="line">ReorderJoin,</span><br><span class="line">EliminateOuterJoin,</span><br><span class="line">PushPredicateThroughJoin,</span><br><span class="line">PushDownPredicate,</span><br><span class="line">LimitPushDown(conf),</span><br><span class="line">ColumnPruning,</span><br><span class="line">InferFiltersFromConstraints,</span><br><span class="line"></span><br><span class="line">// Operator combine</span><br><span class="line">CollapseRepartition,</span><br><span class="line">CollapseProject,</span><br><span class="line">CollapseWindow,</span><br><span class="line">CombineFilters,</span><br><span class="line">CombineLimits,</span><br><span class="line">CombineUnions,</span><br><span class="line"></span><br><span class="line">// Constant folding and strength reduction</span><br><span class="line">NullPropagation(conf),</span><br><span class="line">FoldablePropagation,</span><br><span class="line">OptimizeIn(conf),</span><br><span class="line">ConstantFolding,</span><br><span class="line">ReorderAssociativeOperator,</span><br><span class="line">LikeSimplification,</span><br><span class="line">BooleanSimplification,</span><br><span class="line">SimplifyConditionals,</span><br><span class="line">RemoveDispensableExpressions,</span><br><span class="line">SimplifyBinaryComparison,</span><br><span class="line">PruneFilters,</span><br><span class="line">EliminateSorts,</span><br><span class="line">SimplifyCasts,</span><br><span class="line">SimplifyCaseConversionExpressions,</span><br><span class="line">RewriteCorrelatedScalarSubquery,</span><br><span class="line">EliminateSerialization,</span><br><span class="line">RemoveRedundantAliases,</span><br><span class="line">RemoveRedundantProject,</span><br><span class="line">SimplifyCreateStructOps,</span><br><span class="line">SimplifyCreateArrayOps,</span><br><span class="line">SimplifyCreateMapOps</span><br></pre></td></tr></table></figure>

<h3 id="SQL-Optimizer-è°“è¯ä¸‹æ¨"><a href="#SQL-Optimizer-è°“è¯ä¸‹æ¨" class="headerlink" title="SQL Optimizer è°“è¯ä¸‹æ¨"></a>SQL Optimizer è°“è¯ä¸‹æ¨</h3><p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306202933.png"></p>
<h3 id="SQL-Optimizer-åˆ—å€¼è£å‰ª"><a href="#SQL-Optimizer-åˆ—å€¼è£å‰ª" class="headerlink" title="SQL Optimizer åˆ—å€¼è£å‰ª"></a>SQL Optimizer åˆ—å€¼è£å‰ª</h3><p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306203028.png"></p>
<h2 id="SQL-Planner"><a href="#SQL-Planner" class="headerlink" title="SQL Planner"></a>SQL Planner</h2><ol>
<li><p>ä¸RDDè¿›è¡Œç»‘å®š</p>
</li>
<li><p>é€‰å–æ‰§è¡Œç­–ç•¥</p>
<p>FileSourceStrategy</p>
<p>DataSourceStrategy</p>
<p>SpecialLimits</p>
<p>Aggregation</p>
<p>JoinSelection</p>
<p>InMemoryScans</p>
<p>BasicOperators</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306203120.png"></p>
<h2 id="RDD-DataFrame"><a href="#RDD-DataFrame" class="headerlink" title="RDD DataFrame"></a>RDD DataFrame</h2><p>Sparkæœ¬èº«å¹¶ä¸æ¸…æ¥šRDDä¸­Personå†…éƒ¨çš„ç»“æ„</p>
<ul>
<li>æ‰§è¡Œæ—¶æ— æ³•ä¼˜åŒ–</li>
</ul>
<p>DataFrameæä¾›äº†è¯¦ç»†çš„ç»“æ„ä¿¡æ¯</p>
<ul>
<li>åˆ†å¸ƒå¼Rowå¯¹è±¡é›†åˆ</li>
<li>ç®—å­æ›´åŠ ä¸°å¯Œ</li>
<li>æ‰§è¡Œè®¡åˆ’ä¼˜åŒ–</li>
</ul>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220404112704.png"></p>
<h2 id="Spark-SQL-å®æˆ˜"><a href="#Spark-SQL-å®æˆ˜" class="headerlink" title="Spark SQL å®æˆ˜"></a>Spark SQL å®æˆ˜</h2><p>åˆ›å»ºDataFrame</p>
<ul>
<li>createDataFrameæ–¹æ³•</li>
<li>RDDè°ƒç”¨toDFæ–¹æ³• </li>
<li>ç›´æ¥è¯»å–JSON </li>
<li>ä»Hiveè¡¨ä¸­è¯»å–</li>
</ul>
<p>æ‰§è¡Œä¸šåŠ¡é€»è¾‘</p>
<ul>
<li>sqlContextã€sparkSessionæ‰§è¡Œ</li>
<li>DataFrame API</li>
</ul>
<h3 id="Spark-SQL-å®æˆ˜-1-6"><a href="#Spark-SQL-å®æˆ˜-1-6" class="headerlink" title="Spark SQL å®æˆ˜ 1.6"></a>Spark SQL å®æˆ˜ 1.6</h3><ol>
<li><p>åˆå§‹åŒ–SparkContext</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>()</span><br><span class="line">conf.setAppName(<span class="string">&quot;DataFrameSQL&quot;</span>).setMaster(<span class="string">&quot;local[4]&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆå§‹åŒ–SQLContext</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> sqlContext = <span class="keyword">new</span> <span class="type">SQLContext</span>(sc)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç”ŸæˆDataFrame</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlContext.implicits._</span><br><span class="line"><span class="keyword">val</span> df = <span class="type">Seq</span>( (<span class="number">1</span>, <span class="string">&quot;Bill&quot;</span>, <span class="string">&quot;Computer Science&quot;</span>, <span class="number">100</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&quot;Bill&quot;</span>, <span class="string">&quot;Math&quot;</span>, <span class="number">85</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&quot;Bill&quot;</span>, <span class="string">&quot;English&quot;</span>, <span class="number">90</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&quot;Peter&quot;</span>, <span class="string">&quot;Math&quot;</span>, <span class="number">82</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&quot;Peter&quot;</span>, <span class="string">&quot;Music&quot;</span>, <span class="number">90</span>),</span><br><span class="line">(<span class="number">6</span>, <span class="string">&quot;Peter&quot;</span>, <span class="string">&quot;Chemistry&quot;</span>, <span class="number">85</span>)</span><br><span class="line">).toDF(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;course&quot;</span>, <span class="string">&quot;score&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨ç®—å­æ‰§è¡Œä¸šåŠ¡é€»è¾‘</p>
<ul>
<li><p>ä½¿ç”¨æ ‡å‡†SQLæ‰§è¡Œä¸šåŠ¡é€»è¾‘</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.registerTempTable(<span class="string">&quot;course_score&quot;</span>)</span><br><span class="line">sqlContext.sql(<span class="string">&quot;select name, avg(score) from course_score group by name&quot;</span>).show()</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨DataFrame APIæ‰§è¡Œä¸šåŠ¡é€»è¾‘</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df.groupBy(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">.avg(<span class="string">&quot;score&quot;</span>)</span><br><span class="line">.show()</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h3 id="Spark-SQL-å®æˆ˜-2-0"><a href="#Spark-SQL-å®æˆ˜-2-0" class="headerlink" title="Spark SQL å®æˆ˜ 2.0"></a>Spark SQL å®æˆ˜ 2.0</h3><p>sqlContextã€HiveContextä¸èƒ½ä½¿ç”¨ï¼Œæ”¹ä¸ºsparkSessionï¼Œç»Ÿä¸€APIã€Hiveã€DataFrameã€DataSet</p>
<ol>
<li><p>åˆå§‹åŒ–SparkSession</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> spark = <span class="type">SparkSession</span></span><br><span class="line">.builder()</span><br><span class="line">.appName(<span class="string">&quot;Spark SQL Example&quot;</span>)</span><br><span class="line">.master(<span class="string">&quot;local[4]&quot;</span>)</span><br><span class="line">.config(<span class="string">&quot;spark.some.config.option&quot;</span>, <span class="string">&quot;some-value&quot;</span>)</span><br><span class="line">.getOrCreate()</span><br></pre></td></tr></table></figure>
</li>
<li><p>åŠ è½½æ•°æ®</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> dataSet = spark.range(<span class="number">5</span>, <span class="number">100</span>, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">val</span> dataFrame = spark.read.json(<span class="string">&quot;examples/src/main/resources/people.json&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> resultsDF = spark.sql(<span class="string">&quot;SELECT city, pop, state, zip FROM zips_table&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Enjoy Computing</p>
</li>
</ol>
<h2 id="Spark-SQL-æ•°æ®å€¾æ–œ"><a href="#Spark-SQL-æ•°æ®å€¾æ–œ" class="headerlink" title="Spark SQL æ•°æ®å€¾æ–œ"></a>Spark SQL æ•°æ®å€¾æ–œ</h2><p>ä»€ä¹ˆæ˜¯MapJoinï¼Ÿ<br>    joinå°½é‡ä¸å‘ç”Ÿåœ¨reduceé˜¶æ®µï¼Œå‘ç”Ÿåœ¨mapé˜¶æ®µã€‚æ‹¿æˆç»©æ•°æ®æ¥è®²ï¼Œæ¯ä¸ªäººçš„idã€nameã€ageæ•°æ®é‡æ¯”è¾ƒå°‘ï¼Œæ˜¯ä¸€ä¸ªå­—å…¸è¡¨ï¼Œå®Œå…¨å¯ä»¥æŠŠè¿™ä¸ªæ•°æ®å¹¿æ’­åˆ°æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”Ÿæˆä¸€ä¸ªhashTableï¼Œç›´æ¥é€šè¿‡æŸ¥idå¾—åˆ°nameå’Œageï¼Œè¿™æ ·å¯ä»¥åœ¨mapé˜¶æ®µæŠŠnameå’Œageå…³è”å‡ºæ¥</p>
<ol>
<li><p>Spark 1.6 ä½¿ç”¨MapJoin</p>
<p><strong>CACHE</strong> TABLE xx AS select * from xx</p>
</li>
<li><p>Spark 2.2 ä½¿ç”¨MapJoin Hint</p>
<p>SELECT **&#x2F;<em>+ MAPJOIN(b) <em>&#x2F;</em></em> â€¦</p>
</li>
<li><p>è°ƒæ•´Spark SQLç›¸å…³å‚æ•°</p>
<ul>
<li><p>spark.sql.autoBroadcastJoinThreshold</p>
<p>è¢«å¹¿æ’­è¡¨çš„å¤§å°å°äºè¯¥å€¼æ—¶å¯åŠ¨BroadcastJoinï¼Œé»˜è®¤10MBã€‚ </p>
<p>å¦‚æœéœ€è¦å¹¿æ’­ï¼ŒæœåŠ¡å™¨å†…å­˜æ¯”è¾ƒå¤§å¯ä»¥è°ƒæ•´è¯¥å‚æ•°</p>
</li>
<li><p>spark.sql.broadcastTimeout</p>
<p>å¹¿æ’­ç­‰å¾…è¶…æ—¶æ—¶é—´(ç§’)ï¼Œé»˜è®¤300sã€‚ </p>
</li>
<li><p>spark.sql.shuffle.partitions</p>
<p>joinæˆ–è€…aggregationæ˜¯ä½¿ç”¨å¤šå°‘åˆ†åŒºï¼Œé»˜è®¤200ã€‚</p>
<p>æ•°æ®é‡æ¯”è¾ƒå¤§å¯ä»¥è°ƒé«˜è¯¥å‚æ•°</p>
</li>
</ul>
<p>è§£å†³æ•°æ®å€¾æ–œç›¸å…³é“¾æ¥</p>
<ul>
<li>Sparkæ€§èƒ½ä¼˜åŒ–æŒ‡å—â€”â€”é«˜çº§ç¯‡ - ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ <a target="_blank" rel="noopener" href="https://tech.meituan.com/2016/05/12/spark-tuning-pro.html">https://tech.meituan.com/2016/05/12/spark-tuning-pro.html</a></li>
<li>Sparkæ€§èƒ½ä¼˜åŒ–æŒ‡å—â€”â€”åŸºç¡€ç¯‡ - ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ <a target="_blank" rel="noopener" href="https://tech.meituan.com/2016/04/29/spark-tuning-basic.html">https://tech.meituan.com/2016/04/29/spark-tuning-basic.html</a></li>
</ul>
</li>
</ol>
<h1 id="Spark-MLlib-å®æˆ˜"><a href="#Spark-MLlib-å®æˆ˜" class="headerlink" title="Spark MLlib å®æˆ˜"></a>Spark MLlib å®æˆ˜</h1><p>MLlibæ˜¯Sparkæœºå™¨å­¦ä¹ åº“ï¼ŒåŒ…å«äº†è®¸å¤šé€šç”¨çš„æœºå™¨å­¦ä¹ ç®—æ³•å’Œå·¥å…·ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ</h2><p>è®©æœºå™¨ä»æ•°æ®ä¸­å­¦ä¹ ï¼Œè¿›è€Œå¾—åˆ°ä¸€ä¸ªæ›´åŠ ç¬¦åˆç°å®è§„å¾‹çš„æ¨¡å‹ï¼Œé€šè¿‡å¯¹æ¨¡å‹çš„ä½¿ç”¨ä½¿å¾—æœºå™¨æ¯”ä»¥å¾€è¡¨ç°çš„æ›´å¥½ï¼Œè¿™å°±æ˜¯æœºå™¨å­¦ä¹ ã€‚</p>
<h2 id="MLlib-ç©¶ç«Ÿèƒ½å¹²å•¥ï¼Ÿ"><a href="#MLlib-ç©¶ç«Ÿèƒ½å¹²å•¥ï¼Ÿ" class="headerlink" title="MLlib ç©¶ç«Ÿèƒ½å¹²å•¥ï¼Ÿ"></a>MLlib ç©¶ç«Ÿèƒ½å¹²å•¥ï¼Ÿ</h2><p>ç®—æ³•</p>
<ul>
<li>å›å½’ Regression<br>é¢„æµ‹æœªæ¥çš„å¢é•¿</li>
<li>åˆ†ç±» Classification</li>
<li>èšç±» Clustering<br>å¯¹æŸä¸€ç±»äººç¾¤è¿›è¡ŒæŠ•æ”¾å¹¿å‘Šï¼Œæé«˜è½¬åŒ–ç‡</li>
<li>å†³ç­–æ ‘ Decision trees</li>
<li>ååŒè¿‡æ»¤ Collaborative filtering<br>æ¨èé¢†åŸŸï¼ŒAå’ŒBæ˜¯ç›¸ä¼¼çš„äººï¼ŒAå–œæ¬¢çœ‹å°è¯´ï¼ŒBä¹Ÿæœ‰å¾ˆå¤§å¯èƒ½å–œæ¬¢çœ‹å°è¯´</li>
</ul>
<p>ç‰¹å¾å·¥ç¨‹</p>
<ul>
<li><p>ç‰¹å¾æŠ½å– Feature extraction</p>
</li>
<li><p>é™ç»´ Dimensionality reduction</p>
</li>
</ul>
<p>æŒä¹…åŒ–</p>
<p>å¸¸ç”¨å·¥å…·</p>
<ul>
<li><p>çº¿æ€§ä»£æ•°å·¥å…·é›†</p>
</li>
<li><p>ç»Ÿè®¡å·¥å…·é›†</p>
</li>
</ul>
<p><strong>ç®€å•çš„å†³ç­–æ ‘</strong></p>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306204539.png"></p>
<h2 id="é€»è¾‘å›å½’é¢„æµ‹ä¹³è…ºç™Œ"><a href="#é€»è¾‘å›å½’é¢„æµ‹ä¹³è…ºç™Œ" class="headerlink" title="é€»è¾‘å›å½’é¢„æµ‹ä¹³è…ºç™Œ"></a>é€»è¾‘å›å½’é¢„æµ‹ä¹³è…ºç™Œ</h2><table>
<thead>
<tr>
<th>ç‰¹å¾X</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>Clump Thickness</td>
<td>è‚¿å—åšåº¦</td>
</tr>
<tr>
<td>Uniformity of Cell Size</td>
<td>ç»†èƒå¤§å°å‡åŒ€æ€§</td>
</tr>
<tr>
<td>Uniformity of Cell Shape</td>
<td>ç»†èƒå½¢çŠ¶å‡åŒ€æ€§</td>
</tr>
<tr>
<td>Marginal Adhesion</td>
<td>è¾¹ç¼˜é™„ç€åŠ›</td>
</tr>
<tr>
<td>Single Epithelial Cell Size</td>
<td>å•ä¸Šçš®ç»†èƒå¤§å°</td>
</tr>
<tr>
<td>Bare Nuclei</td>
<td>è£¸æ ¸</td>
</tr>
<tr>
<td>Bland Chromatin</td>
<td>æŸ“è‰²è´¨</td>
</tr>
<tr>
<td>Normal Nucleoli</td>
<td>æ­£å¸¸æ ¸ä»</td>
</tr>
<tr>
<td>Mitoses</td>
<td>æœ‰ä¸åˆ†è£‚</td>
</tr>
</tbody></table>
<p>é¢„æµ‹Yï¼šè‰¯æ€§ or æ¶æ€§</p>
<h2 id="é€»è¾‘å›å½’æ¨¡å‹"><a href="#é€»è¾‘å›å½’æ¨¡å‹" class="headerlink" title="é€»è¾‘å›å½’æ¨¡å‹"></a>é€»è¾‘å›å½’æ¨¡å‹</h2><p>å‡è®¾æœ‰ä¸ªå‡½æ•°y &#x3D; hğœƒ(ğ‘¥)å¯ä»¥å¸®åŠ©æˆ‘ä»¬é¢„æµ‹ç™Œç—‡ï¼Œä¸”0 â‰¤ hğœƒ(ğ‘¥) â‰¤ 1</p>
<p>è‰¯æ€§y &#x3D; 0</p>
<p>æ¶æ€§y &#x3D; 1</p>
<h2 id="Sigmoidå‡½æ•°"><a href="#Sigmoidå‡½æ•°" class="headerlink" title="Sigmoidå‡½æ•°"></a>Sigmoidå‡½æ•°</h2><p>xçš„å–å€¼èŒƒå›´æ˜¯è´Ÿæ— ç©·å¤§åˆ°æ­£æ— ç©·å¤§ï¼Œyä¸ºè¯¥å‡½æ•°ç®—å‡ºçš„å€¼ï¼Œä»¥0ä½œä¸ºåˆ†ç•Œç‚¹ï¼ŒæŠŠ0ä»£å…¥xï¼Œeçš„è´Ÿ0æ¬¡æ–¹ä¸º1ï¼Œ2åˆ†ä¹‹1ä¸º0.5ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠsigmoidå‡½æ•°ç”¨æ¥å»åšä¸€ä¸ªæ¦‚ç‡çš„æ˜ å°„ï¼Œå°äº0.5è®¤ä¸ºæ˜¯è‰¯æ€§ï¼Œå¤§äºç­‰äº0.5æ˜¯æ¶æ€§</p>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306204833.png"><br>$$<br>ğ‘”(x) &#x3D; \dfrac{1} {1+ğ‘’^{-ğ‘¥â€™}}ï¼Œg(x)ä¸ºsigmoidå‡½æ•°<br>$$</p>
<h2 id="LRåˆ†ç±»Example"><a href="#LRåˆ†ç±»Example" class="headerlink" title="LRåˆ†ç±»Example"></a>LRåˆ†ç±»Example</h2><p>é€»è¾‘å›å½’ï¼Œå…ˆåœ¨å›¾ä¸Šç”»å‡ºæ•°æ®ï¼Œå‡è®¾æˆ‘ä»¬åªæœ‰2ä¸ªç»´åº¦x1ã€x2ã€‚æ¨ªè½´ä¸ºx1ï¼Œçºµè½´ä¸ºx2ã€‚ç±»åˆ«æŒ‰ä¸åŒçš„é¢œè‰²æ¥è¡¨ç¤ºï¼Œè“è‰²å’Œæ©˜è‰²ã€‚</p>
<p>å»è®­ç»ƒå‡ºä¸€ä¸ªå¹³é¢ï¼Œç”¨ä¸€æ ¹çº¿æŠŠä¿©ç±»æ•°æ®åˆ†å¼€ï¼Œè¿™ä¸ªå«çº¿æ€§å¯åˆ†ã€‚åœ¨çº¿ä¸‹å’Œçº¿ä¸Šå¯ä»¥åˆ†ä¸ºä¸¤ç±»æ•°æ®ã€‚å½“æˆ‘ä»¬æ¥äº†ä¸€ä¸ªæ–°çš„å€¼x1ã€x2ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠä»–å¸¦å…¥åˆ°è¿™ä¸ªæ–¹ç¨‹é‡Œé¢ï¼Œæ¥çœ‹æ•°æ®æ˜¯åœ¨çº¿çš„ä¸‹é¢è¿˜æ˜¯ä¸Šé¢</p>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205421.png"></p>
<h2 id="Spark-MLlib-è®­ç»ƒæ¨¡å‹æµç¨‹"><a href="#Spark-MLlib-è®­ç»ƒæ¨¡å‹æµç¨‹" class="headerlink" title="Spark MLlib è®­ç»ƒæ¨¡å‹æµç¨‹"></a>Spark MLlib è®­ç»ƒæ¨¡å‹æµç¨‹</h2><p>æ¨¡å‹è®­ç»ƒæµç¨‹</p>
<ul>
<li>åŠ è½½æ•°æ®</li>
<li>æ•°æ®æŠ½å–</li>
<li>è®­ç»ƒå‡ºæ¨¡å‹</li>
<li>æ¨¡å‹è¯„ä¼°</li>
</ul>
<p>æ¨¡å‹æµ‹è¯•æµç¨‹</p>
<ul>
<li><p>åŠ è½½æ•°æ®ï¼Œä½¿ç”¨æ¨¡å‹ä»æœªæ¥è§¦è¿‡çš„æ•°æ®æµ‹è¯•</p>
</li>
<li><p>æ•°æ®æŠ½å–</p>
</li>
<li><p>é¢„æµ‹ç»“æœ</p>
</li>
<li><p>æ¨¡å‹è¯„ä¼°</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205450.png"></p>
<h2 id="ä¹³è…ºç™Œæ•°æ®æº"><a href="#ä¹³è…ºç™Œæ•°æ®æº" class="headerlink" title="ä¹³è…ºç™Œæ•°æ®æº"></a>ä¹³è…ºç™Œæ•°æ®æº</h2><p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205524.png"></p>
<h3 id="Step-1-æ¸…æ´—æ•°æ®"><a href="#Step-1-æ¸…æ´—æ•°æ®" class="headerlink" title="Step 1 æ¸…æ´—æ•°æ®"></a>Step 1 æ¸…æ´—æ•°æ®</h3><p>String &#x3D;&gt;Object</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parseRDD</span></span>(rdd: <span class="type">RDD</span>[<span class="type">String</span>]): <span class="type">RDD</span>[<span class="type">Array</span>[<span class="type">Double</span>]] = &#123;</span><br><span class="line">rdd.map(_.split(<span class="string">&quot;,&quot;</span>)).filter(_(<span class="number">6</span>) != </span><br><span class="line"><span class="string">&quot;?&quot;</span>).map(_.drop(<span class="number">1</span>)).map(_.map(_.toDouble))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205628.png"></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parseObs</span></span>(line: <span class="type">Array</span>[<span class="type">Double</span>]): <span class="type">Obs</span> = &#123;</span><br><span class="line"><span class="type">Obs</span>(</span><br><span class="line"><span class="keyword">if</span> (line(<span class="number">9</span>) == <span class="number">4.0</span>) <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span>, line(<span class="number">0</span>), line(<span class="number">1</span>), line(<span class="number">2</span>), line(<span class="number">3</span>), </span><br><span class="line">line(<span class="number">4</span>), line(<span class="number">5</span>), line(<span class="number">6</span>), line(<span class="number">7</span>), line(<span class="number">8</span>)</span><br><span class="line">) &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Step-2-åˆ†å‰²è®­ç»ƒé›†å’Œæµ‹è¯•é›†"><a href="#Step-2-åˆ†å‰²è®­ç»ƒé›†å’Œæµ‹è¯•é›†" class="headerlink" title="Step 2 åˆ†å‰²è®­ç»ƒé›†å’Œæµ‹è¯•é›†"></a>Step 2 åˆ†å‰²è®­ç»ƒé›†å’Œæµ‹è¯•é›†</h3><p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205524.png"></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> splitSeed = <span class="number">5043</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">Array</span>(trainingData, testData) = </span><br><span class="line">df3.randomSplit(<span class="type">Array</span>(<span class="number">0.7</span>, <span class="number">0.3</span>), </span><br><span class="line">splitSeed)</span><br></pre></td></tr></table></figure>

<h3 id="Step-3-è®­ç»ƒæ¨¡å‹"><a href="#Step-3-è®­ç»ƒæ¨¡å‹" class="headerlink" title="Step 3 è®­ç»ƒæ¨¡å‹"></a>Step 3 è®­ç»ƒæ¨¡å‹</h3><p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205728.png"></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> lr = <span class="keyword">new</span> <span class="type">LogisticRegression</span>()</span><br><span class="line"><span class="comment">// è®¾ç½®æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</span></span><br><span class="line">.setMaxIter(<span class="number">10</span>)</span><br><span class="line"><span class="comment">// æ­£åˆ™åŒ–å‚æ•°ï¼Œå°è¯•æŠŠä¸€ä¸ªæ¨¡å‹æŠŠç®€å•æ–¹å‘è®­ç»ƒï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</span></span><br><span class="line"><span class="comment">// è¿‡æ‹Ÿåˆæ˜¯å¯¹æµ‹è¯•é›†æ‹Ÿåˆçš„è¿‡å¥½ï¼Œå¾€å¾€æ•°æ®ä¼šæœ‰ä¸€äº›æ³¢åŠ¨å’Œå¼‚å¸¸å€¼ï¼Œå½“æ¨¡å‹å¯¹äºæ•°æ®æ‹Ÿåˆè¿‡å¥½ä¹‹åï¼Œåœ¨å®é™…åº”ç”¨ä¸­ä¼šå‘ç°ç»“æœä¼šå¾ˆå·®ï¼Œå’Œå®é™…ä¸ç›¸ç¬¦ã€‚æ¨¡å‹é€šå¸¸æ¥è®²è¶Šç®€å•ï¼Œæä¾›çš„æ•ˆæœè¶Šå¥½</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥è¿™è¾¹ä¼šè®¾ç½®ä¸€äº›å‚æ•°ï¼Œå°è¯•è®©x0...xnå‚æ•°è¶‹è¿‘äº0ï¼Œå½“ç‰¹å¾è¶Šå°‘ï¼Œç•™ä¸‹çš„ç‰¹å¾éƒ½æ˜¯ä¸€äº›é‡è¦çš„ç‰¹å¾</span></span><br><span class="line">.setRegParam(<span class="number">0.3</span>)</span><br><span class="line">.setElasticNetParam(<span class="number">0.8</span>)</span><br><span class="line"><span class="keyword">val</span> model = lr.fit(trainingData)</span><br></pre></td></tr></table></figure>

<h3 id="Step-4-è¯„ä¼°æ¨¡å‹"><a href="#Step-4-è¯„ä¼°æ¨¡å‹" class="headerlink" title="Step 4 è¯„ä¼°æ¨¡å‹"></a>Step 4 è¯„ä¼°æ¨¡å‹</h3><p><img src="https://raw.githubusercontent.com/chengchen901/img/master/blog/20220306205809.png"></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> predictions = model.transform(testData)</span><br><span class="line">predictions.select(<span class="string">&quot;clas&quot;</span>, <span class="string">&quot;label&quot;</span>, <span class="string">&quot;prediction&quot;</span>)</span><br><span class="line">.show(<span class="number">50</span>)</span><br><span class="line"><span class="keyword">val</span> evaluator = <span class="keyword">new</span> <span class="type">BinaryClassificationEvaluator</span>()</span><br><span class="line">.setLabelCol(<span class="string">&quot;label&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> accuracy = evaluator.evaluate(predictions)</span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/09/10/13-%E5%A4%A7%E6%95%B0%E6%8D%AE/03-Spark/03-SparkShuffle&SQL&MLlib/" data-id="clmcxec7o0015u8waf1yqhp7j" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/09/10/13-%E5%A4%A7%E6%95%B0%E6%8D%AE/03-Spark/04-StructuredStreaming/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2023/09/09/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ActiveMQ/">ActiveMQ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Dubbo/">Dubbo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Golang/">Golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">JavaåŸºç¡€</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/K8s/">K8s</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kafka/">Kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MQ/">MQ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mybatis/">Mybatis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Netty/">Netty</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/RPC/">RPC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/RabbitMQ/">RabbitMQ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Socker/">Socker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringBoot/">SpringBoot</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringCloud/">SpringCloud</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tomcat/">Tomcat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ZooKeeper/">ZooKeeper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zookeeper/">Zookeeper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">å¤§æ•°æ®</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">æ•°æ®ç»“æ„</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/">é¢è¯•é¢˜</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ActiveMQ/" rel="tag">ActiveMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CDH/" rel="tag">CDH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dubbo/" rel="tag">Dubbo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HDFS/" rel="tag">HDFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K8s/" rel="tag">K8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KDTree/" rel="tag">KDTree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/" rel="tag">Kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MQ/" rel="tag">MQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MapReduce/" rel="tag">MapReduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis/" rel="tag">Mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Netty/" rel="tag">Netty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPC/" rel="tag">RPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/" rel="tag">RabbitMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Socker/" rel="tag">Socker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark/" rel="tag">Spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud/" rel="tag">SpringCloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/" rel="tag">Tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/YARN/" rel="tag">YARN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ZooKeeper/" rel="tag">ZooKeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">å¤šçº¿ç¨‹</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%A8%E8%A7%A3/" rel="tag">æ³¨è§£</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">è®¾è®¡æ¨¡å¼</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E5%90%88%E6%BA%90%E7%A0%81/" rel="tag">é›†åˆæºç </a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">é¢è¯•é¢˜</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ActiveMQ/" style="font-size: 10px;">ActiveMQ</a> <a href="/tags/CDH/" style="font-size: 10px;">CDH</a> <a href="/tags/Docker/" style="font-size: 18px;">Docker</a> <a href="/tags/Dubbo/" style="font-size: 13px;">Dubbo</a> <a href="/tags/Golang/" style="font-size: 19px;">Golang</a> <a href="/tags/HDFS/" style="font-size: 10px;">HDFS</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/KDTree/" style="font-size: 10px;">KDTree</a> <a href="/tags/Kafka/" style="font-size: 10px;">Kafka</a> <a href="/tags/MQ/" style="font-size: 10px;">MQ</a> <a href="/tags/MapReduce/" style="font-size: 10px;">MapReduce</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Mybatis/" style="font-size: 14px;">Mybatis</a> <a href="/tags/Netty/" style="font-size: 14px;">Netty</a> <a href="/tags/RPC/" style="font-size: 11px;">RPC</a> <a href="/tags/RabbitMQ/" style="font-size: 15px;">RabbitMQ</a> <a href="/tags/Redis/" style="font-size: 17px;">Redis</a> <a href="/tags/Socker/" style="font-size: 10px;">Socker</a> <a href="/tags/Spark/" style="font-size: 11px;">Spark</a> <a href="/tags/Spring/" style="font-size: 20px;">Spring</a> <a href="/tags/SpringBoot/" style="font-size: 14px;">SpringBoot</a> <a href="/tags/SpringCloud/" style="font-size: 10px;">SpringCloud</a> <a href="/tags/Tomcat/" style="font-size: 13px;">Tomcat</a> <a href="/tags/YARN/" style="font-size: 11px;">YARN</a> <a href="/tags/ZooKeeper/" style="font-size: 12px;">ZooKeeper</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 16px;">å¤šçº¿ç¨‹</a> <a href="/tags/%E6%B3%A8%E8%A7%A3/" style="font-size: 10px;">æ³¨è§£</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 11px;">è®¾è®¡æ¨¡å¼</a> <a href="/tags/%E9%9B%86%E5%90%88%E6%BA%90%E7%A0%81/" style="font-size: 13px;">é›†åˆæºç </a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 10px;">é¢è¯•é¢˜</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/09/10/11-MySQL/04-MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E5%8F%8A%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/05-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E6%90%AD%E5%BB%BA%E6%89%8B%E5%86%8C/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/09/10/11-MySQL/04-MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E5%8F%8A%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/04-Sharding-JDBC%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/09/10/11-MySQL/04-MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E5%8F%8A%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/03-MyCat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/09/10/11-MySQL/04-MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E5%8F%8A%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/02-MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/09/10/11-MySQL/04-MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E5%8F%8A%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/01-MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>